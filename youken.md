 # 📋 アプリケーション要件まとめ：未来視 (Miraishi)
 
 本シミュレーター「未来視 (Miraishi)」は、日本の新卒エンジニアがキャリアを積む上での給与・手当の推移を予測し、将来の収入見込みを把握することでキャリアプランニングを支援することを目的とします。
 
 ---
 
 ## 🔑 独自用語集とレイアウト階層
 
 アプリの構成とUI要素の役割を明確にするため、以下の独自用語とレイアウト階層を定義します。
 
 - **メインウィンドウ (Main Window)**
   - アプリ全体を内包する最上位のコンテナ。デスクトップアプリの画面全体を指します。
 - **コントロールパネル (Control Panel)**
   - **メインウィンドウ**の左側に固定配置されるパネル。アプリ全体の**設定や主要なナビゲーション**を司ります。ハンバーガーメニューとして実装されます。
 - **メインパネル (Main Panel)**
   - **メインウィンドウ**の右側、**コントロールパネル**の隣に配置される主要な表示領域。ユーザーの操作に応じて、**データビュー**、**グラフビュー**、**シナリオビュー**のいずれかが表示されます。また、**複数シナリオの比較表示機能**もこのパネル内で提供されます。
 - **ビュー (View)**
   - Webサイトの「ページ」や「コンポーネント」に相当する機能単位。**メインパネル**内に表示が切り替わる形で配置されます。
     - **データビュー (Data View)**: ユーザーがシミュレーションの基となる初期データを入力し、その場で手取り額の計算結果を確認できるビュー。
     - **グラフビュー (Graph View)**: 入力されたデータに基づき、将来の月収・年収・手当の推移をグラフで視覚的に表示するビュー。データビューの上にフロート表示されます。
     - **シナリオビュー (Scenario View)**: ユーザーが入力した条件セットである「シナリオ」を管理（保存、呼び出し、インポート/エクスポート）するビュー。コントロールパネルの下部レイヤーに統合されます。
 - **セクション (Section)**
   - 各ビューの内部を構成する機能的なまとまり。
     - **入力セクション**: データビュー内で、基本給、手当、残業代、給与成長率といった初期データを入力する部分。
     - **計算セクション**: データビュー内で、入力された額面情報に基づき手取り額を計算・表示する部分。
     - **コントロールセクション**: グラフビュー内で、予測期間や残業時間、表示項目などグラフ表示を調整する操作部分。
     - **グラフセクション**: グラフビュー内で、実際のグラフ表示領域。
     - **ボタンセクション**: コントロールパネルの最上段にある、ハンバーガーボタンと検索ボタンの領域。
     - **シナリオリストセクション**: コントロールパネルの中段にある、シナリオタイトル、インポートボタン、シナリオ一覧の領域。
 - **シナリオ (Scenario)**
   - ユーザーが設定した給与・手当に関する一連の入力条件のセット。
 
 ### 🌳 レイアウト階層のツリー図
 
```

メインウィンドウ (Main Window)
├── コントロールパネル (Control Panel)  \<-- 左端に固定配置、ハンバーガーメニュー形式
│   ├── ボタンセクション (Button Section)           \<-- 最上段
│   │   ├── ハンバーガーボタン (左端)
│   │   └── 検索ボタン (右端)  --アニメーション--\> 白い楕円形フォーム(検索ボタンがフォーム左端へ移動、右端にXボタン)
│   │
│   ├── シナリオ新規作成ボタン (例: シナリオリストセクションの直上)
│   │
│   └── シナリオビュー (Scenario View) \<-- コントロールパネルの下部レイヤーに統合
│       └── シナリオリストセクション (Scenario List Section)   \<-- 中段
│           ├── タイトル「シナリオ」とインポートボタン (上部、横並び)
│           ├── (インポート成否メッセージ表示エリア)
│           └── シナリオのリスト (スクロール可能)
│               └── 各シナリオボタン (名前省略、右に︙ボタン)
│
└── メインパネル (Main Panel)  \<-- 右側、コントロールパネルの隣に配置
├── データビュー (Data View)
│   ├── 横データビュー (シナリオ1つの場合)
│   │   ├── 入力セクション (左側、画面を大きく使う)
│   │   └── 計算セクション (右側、画面を大きく使う)
│   └── 縦データビュー (複数シナリオの場合)
│       ├── 入力セクション (上側、縦長)
│       └── 計算セクション (下側、縦長)
│       (※メインパネル内に複数並び、2つ超えると横スクロール)
│
├── グラフビュー (Graph View)  \<-- データビューの上にフロート表示 (7:3で左右分割)
│   ├── グラフセクション (Graph Section) (左側 70%の領域)
│   └── コントロールセクション (Control Section) (右側 30%の領域)
│
└── (その他のビュー - 現在は定義なし)

```

---

## ✅ 機能要件

### 📊 データ機能 (データビュー内)

- **データビューのコンポーネント化とタイトル編集・削除**:
  - データビュー全体を、メインパネルに対して**一つの独立したコンポーネント**として表示し、周囲を**枠線で囲う**。
  - 枠線の上部または左上隅に、画像のような**`legend`要素風のセクション名（タイトル）**を表示。
  - セクション名（タイトル）の初期値は「データビュー1」などとし、**クリックするとその場で編集できる**ようにする（インライン編集）。
  - セクション名（タイトル）の横に**「X」ボタン**を配置し、クリックするとそのデータビューがメインパネルから削除される。
- **初月給入力**:
  - 基本給（月額）の入力。
- **手当入力（複数入力可能）**:
  - ユーザーがプラスボタンで手当入力欄を追加できる。
  - 手当名、月の金額（固定金額または基本給に対する係数）、手当の期限（無制限、N年、Nヶ月）を入力。
- **残業代入力**:
  - **固定残業代**: 有無を選択。有りの場合、固定残業代の金額と固定残業時間を入力。
  - **非固定残業代**: 有無を選択。有りの場合、月々の残業単価の計算方法（例：基本給からの算出）を設定。
- **給与成長率**:
  - 年率N%での給与成長率を入力（毎年、前年の給与に乗算）。

### 📈 予測機能 (グラフビュー内)

- **残業時間設定**:
  - 予測に用いる月平均残業時間を入力（コントロールセクション内）。
- **予測期間設定**:
  - シミュレーションを行う期間（例：5年〜30年）をスライダーで設定し、数値表示も行う（コントロールセクション内）。
- **予測結果表示**:
  - 設定期間における月収、年収、手当の内訳推移を表示（グラフセクション、または詳細テーブル）。
  - 年収、月収の推移グラフを表示し、グラフ上の点をクリックするとその時点での年収や税収、手取り額などが逆表示されるインタラクティブ機能（グラフセクション）。
  - 予測結果をテーブル形式で表示（グラフセクション内に切り替え、または下部に表示）。
- **表示項目の選択**:
  - グラフに表示する項目を単一選択のトグルボタンで切り替え可能（年収（額面）、年収（手取り）、月収（額面）、月収（手取り）など）（コントロールセクション内）。

### 🧮 計算機能 (データビュー内)

- **手取り額算出**:
  - 「データ機能」で入力された額面情報に基づき、現在の税制（所得税、住民税、社会保険料など）を考慮した月額・年額の手取り額を算出。
- **追加情報入力**:
  - 扶養家族の有無、人数、控除の種類・金額（医療費控除、生命保険料控除、iDeCoなど）を任意で入力。
- **計算結果表示**:
  - 月ごと、年ごとの税金・社会保険料の内訳と合計額、および手取り額をテーブル表示。
- **法改正対応**:
  - 税法上の計算式や係数などの情報を**JSON形式のスキーマファイル**で管理。
  - 法改正時には、これらのスキーマファイルをパッチとして置き換えることで、計算ロジックを更新できる仕組み。

### 💾 保存・比較機能 (メインパネル、コントロールパネル/シナリオビュー)

- **シナリオ保存**:
  - メインパネルで作業中のシナリオを、シナリオビューへ行かずにその場で保存できるボタン（「保存」ボタンなど）。クリックするとシナリオ名を入力するダイアログなどが表示される（コントロールパネル）。
- **シナリオの新規作成**:
  - 新しい空のシナリオを作成し、データビューに適用するボタン（コントロールパネルの「シナリオリストセクション」上部に配置）。
- **シナリオのインポート/エクスポート**:
  - 保存したシナリオをJSON形式でエクスポート可能。JSON形式のシナリオデータをインポート可能（シナリオビューの「管理セクション」）。
- **シナリオ比較表示**:
  - 複数の保存済みシナリオを選択し、そのデータビューを**縦データビュー**として**メインパネル**に複数追加し、横スクロールで閲覧可能にする（シナリオビューからトリガーし、メインパネルで表示）。
  - グラフビューでは、選択された複数シナリオの予測結果グラフを重ねて表示（異なる色や線種で判別）。

---

## 🖥️ UI/UX要件

### 🎨 アプリのブランドとデザイン

- **アプリケーション名**: **未来視 (Miraishi)**
  - **雰囲気**: 🚀 **モダンでプロフェッショナル、かつ親しみやすい**。適度な角丸（`border-radius: md`）をUIコンポーネントに持たせることで、シャープさと柔らかさのバランスを取る。
- **全体的なカラースキーム**:
-   **ベースカラー (主要な背景色)**: ライト系の紫（`oklch(1 0 0)` to `oklch(0.967 0.001 286.375)`) とダーク系の紫 (`oklch(0.141 0.005 285.823)` to `oklch(0.274 0.006 286.033)`）。
-   **メインコントラストカラー (文字・主要な要素)**: ライトテーマでは濃い紫 (`oklch(0.141 0.005 285.823)`)、ダークテーマでは明るい白 (`oklch(0.985 0 0)`)。
-   **プライマリーカラー (強調色)**: 明るい紫 (`oklch(0.606 0.25 292.717)`)。ダークテーマでは少し濃い紫 (`oklch(0.541 0.281 293.009)`)。
-   **セカンダリーカラー (補助色)**: 薄い紫 (`oklch(0.967 0.001 286.375)`)。ダークテーマでは少し濃い紫 (`oklch(0.274 0.006 286.033)`)。
-   **アクセントカラー (インタラクティブ要素・グラフ)**: 明るいTeal系（`oklch(0.646 0.222 41.116)` など）。グラフの比較には、このTealを基調としつつ、彩度や明度を調整した異なるTealのバリエーション（例：`oklch(0.6 0.118 184.704)`, `oklch(0.398 0.07 227.392)`など）を使用。
-   **ニュートラルカラー**: ライトグレー (`oklch(0.92 0.004 286.32)`), ダークグレー (`oklch(1 0 0 / 10%)`)。
-   **注意色**: 赤系 (`oklch(0.577 0.245 27.325)`)。

### 🖱️ ナビゲーションとビューの切り替え

- **コントロールパネルからの切り替え**: コントロールパネルのナビゲーション（ボタンなど）で、**データビュー**、**グラフビュー**、**シナリオビュー**をメインパネルに表示を切り替える。
- **グラフビューのフロート表示**:
  - メインパネルの画面端に「`<<`」ボタンを配置し、クリックするとグラフビューが現在のデータビューの上にフロート表示される。
  - グラフビュー表示中は、下のデータビューは半透明化または操作無効化され、関係性を示す。
  - グラフビューを閉じるための「**X**」ボタンや、データビューに戻るための「`>>`」ボタンを配置。

### ⚙️ 各ビューのUI/UX要件（セクション・コンポーネントの位置関係・大きさ注釈付き）

#### 🕹️ コントロールパネル (Control Panel)

- **位置・大きさ**: メインウィンドウの**左端に固定配置**される、通常は折りたたまれた縦長のパネル。展開時には適切な幅（例：メインウィンドウ幅の1/4〜1/3程度）で広がり、コンテンツを表示する。
- **ハンバーガーメニュー**: 折りたたみ/展開のアニメーションは滑らかに。
- **最上段：ボタンセクション**:
  - **ハンバーガーボタン（左端）**: パネルを閉じるためのボタン。
  - **検索ボタン（右端）**:
    - クリックすると、そのボタンの場所に**白い楕円形の検索フォーム**がアニメーションしながら出現。
    - 検索ボタン自体が**フォームの左端にアニメーション移動し、フォームと一体化**。
    - フォームには入力フィールドと、右端に**「X」ボタン（入力内容クリア）**を配置。
    - フォーム外部クリック、またはコントロールパネル閉じでフォーム閉鎖。
- **シナリオ新規作成ボタン**:
  - コントロールパネル展開時、シナリオリストセクションの直上（またはリスト内の最上部）に配置。明確なボタンとして。
- **シナリオビュー（シナリオリストセクション）**:
  - コントロールパネルの中段から下部を占める領域に配置。
  - **タイトルとインポートボタン**:
    - 左端に「シナリオ」というタイトル。
    - 右端にインポートアイコンの付いたボタン。これらは横並びで表示。
    - インポート成否メッセージは、タイトル・インポートボタンとリストの間に一時的に表示（灰/赤文字、小さく）。
  - **シナリオリスト**: タイトル・インポートボタンの下に配置され、縦にスクロール可能。
    - 各シナリオはボタンとして表示。シナリオ名が長い場合は「…」で省略（ツールチップで全文表示）。
    - ボタンの右横には「︙」ボタンを配置し、クリックで「シナリオを追加」「名前の変更」「削除」「エクスポート」のメニュー表示。

#### 📊 データビュー (Data View)

- **コンポーネント表示**:
  - メインパネルに対して、**周囲を枠線で囲われた一つの独立したコンポーネント**として表示される。
  - 枠線の上部または左上隅に、画像のように背景と同色または少し濃い色で埋められた**`legend`要素風のセクション名（タイトル）**を表示。
  - セクション名（タイトル）の初期値は「データビュー1」「シナリオA」など、判別しやすいものとする。
  - **タイトル編集**: セクション名（タイトル）を**クリックすると、その場で編集可能な状態になる**（インライン編集）。編集確定はEnterキーまたはフォーカスアウトで。
  - **削除ボタン**: セクション名（タイトル）の横に**「X」ボタン**を配置。クリックすると、そのデータビューコンポーネントがメインパネルから削除される。
- **シナリオが1つの場合（横データビュー）**:
  - メインパネル全体を大きく使用。
  - **入力セクション**: データビューコンポーネントの**左側**に配置。データビューコンポーネント内の約半分を占める。
  - **計算セクション**: データビューコンポーネントの**右側**に配置。入力セクションの右隣で、データビューコンポーネント内の残りの半分を占める。
  - 入力フィールドには明確なラベル、ツールチップ、プレースホルダー。
  - 手当の動的追加は明確なプラスボタンで、行ごとに削除ボタンも提供。
  - 残業代の切り替えはラジオボタンやトグルで、選択に応じて入力フィールドが表示・非表示。
- **シナリオが複数の場合（縦データビュー）**:
  - メインパネル内に、追加されたデータビューが**縦長**に表示される。
  - 各縦データビューコンポーネントは、メインパネルの**幅の約1/2**を占める。
  - この縦データビューコンポーネント内では、**入力セクションが上側**、**計算セクションが下側**に**縦並び**で配置される。
  - 追加された縦データビューコンポーネントが2つを超えた場合、メインパネル内で**横スクロール**が可能となり、全てのビューを閲覧できるようにする。

#### 📈 グラフビュー (Graph View)

- **表示方法**: メインパネル内で、現在のデータビューの上に**フロート（オーバーレイ）**して表示。
  - フロート時、下のデータビューは半透明化または操作無効化。
  - ビューを閉じるための「**X**」ボタンや、データビューに戻るための「`>>`」ボタンを配置。
- **レイアウト**: フロートするグラフビューの内部を、**左側70%をグラフセクション**、**右側30%をコントロールセクション**として垂直に分割。
- **グラフセクション（左70%）**:
  - メインエリアを占め、**予測グラフ（折れ線グラフ）**を大きく表示。
  - 複数シナリオは異なる色と凡例で表示（凡例はグラフ下部またはセクション内に配置）。
  - インタラクティブ機能：点クリックで詳細表示（ツールチップまたは専用パネル）。
- **コントロールセクション（右30%）**:
  - グラフの右側に固定的に配置される縦長のパネル。
  - **予測期間設定**:
    - **スライダー**を配置。スライダーの横に現在選択期間の数値表示テキストボックス。
  - **月平均残業時間入力**:
    - 数値入力フィールド（例：0〜80時間）と「時間/月」単位を明記。
  - **表示項目の選択（単一選択トグルボタン）**:
    - 「年収（額面）」「年収（手取り）」「月収（額面）」「月収（手取り）」などの項目を縦または横並びの**トグルボタン**として配置。アイコン併記も検討。

---

## 🚀 実装要件

- **デスクトップアプリフレームワーク**: **Electron-Vite**
- **フロントエンドフレームワーク**: **React** (TypeScriptと組み合わせて使用)
- **UIコンポーネントライブラリ**: **shadcn-ui**
- **状態管理ライブラリ**: **Jotai**
- **JSONスキーマバリデーション**: **Zod**
- **日付操作ライブラリ**: **date-fns**
- **テストフレームワーク**: **Vitest**
- **グラフ描画ライブラリ**: **react-chartjs-2** (内部でChart.jsを使用)
- **ローカルストレージ**: **electron-store**
- **バージョン管理**: **GitHub**
- **リリース/デプロイ**: **electron-builder** (Electron-Viteに組み込みのパブリッシュ機能を使用)
- **アプリ内アップデート**: **electron-updater**
- **環境変数管理**: **dotenv** (GitHub `GH_TOKEN`などの管理用)
- **コード品質**: **ESLint** および **Prettier** (Electron-Viteのデフォルトをそのまま活用)
- **導入しないライブラリ**: 汎用ユーティリティライブラリ（Lodashなど）は導入しない。
- **ドキュメンテーション**: README.mdは開発の最後に作成。
- **見送る要件**: CI/CD、エラー監視と分析、パフォーマンス監視（開発中はElectron DevToolsを活用）。

---

## ⚙️ 未確定要件

- **給与成長減衰率係数**:
  - 職歴が上がるにつれて給与の成長度合いが下がることを考慮するための係数。
  - 現段階では必須ではないが、将来的に実装できれば、より高精度な予測が可能になる。
